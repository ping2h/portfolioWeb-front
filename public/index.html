<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Pro | Investment Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4C6FFF;
            --primary-light: #6B8AFF;
            --secondary-color: #74ebc4;
            --accent-color: #8950FC;
            --success-color: #74ebc4;
            --danger-color: #c46060e3;
            --warning-color: #F59E0B;

            /* 毛玻璃风格变量 */
            --text-primary: rgba(255, 255, 255, 0.9);
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-tertiary: rgba(255, 255, 255, 0.6);
            --bg-card: rgba(255, 255, 255, 0.349);
            --card-border: rgba(255, 255, 255, 0.1);
            --divider: rgba(255, 255, 255, 0.15);
            --top-nav-gray: rgba(26, 26, 39, 0.85);
            --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            --dropdown-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        body {
            font-family: 'Manrope', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            color: var(--text-primary);
            line-height: 1.6;
            padding-top: 70px;
            margin: 0;
            min-height: 100vh;
            /* 背景图片设置 */
            background-image: url('https://www.10wallpaper.com/wallpaper/1366x768/2407/Modern_City_Night_Skyscrapers_Horizon_Dusk_5K_1366x768.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            position: relative;
        }

        /* 背景模糊遮罩 */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: inherit;
            filter: blur(5px);
            z-index: -1;
            transform: scale(1.02);
        }

        /* 顶部导航栏样式 */
        .top-nav {
            background: var(--top-nav-gray);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            box-shadow: var(--card-shadow);
            padding: 0.5rem 1.5rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: auto;
            border-bottom: 1px solid var(--card-border);
            flex-wrap: wrap;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-shrink: 0;
        }

        .logo h1 {
            font-size: 1.4rem;
            font-weight: 700;
            margin: 0;
            color: white;
            letter-spacing: -0.5px;
        }

        .logo h1 span {
            background: linear-gradient(to right, var(--primary-light), var(--accent-color));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* 导航链接链接容器 */
        .nav-links {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0 0.5rem;
            flex: 1;
        }

        .nav-item {
            padding: 0.7rem 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.65rem;
            color: rgba(227, 222, 222, 0.8);
            text-decoration: none;
            transition: all 0.3s ease;
            border-radius: 8px;
            font-size: 0.9rem;
            position: relative;
            font-weight: 500;
            flex-shrink: 0;
        }

        .nav-item:hover,
        .nav-item.active {
            background: rgba(255, 255, 255, 0.15);
            color: white;
        }

        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background: var(--secondary-color);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--secondary-color);
        }

        .nav-item i {
            width: 1.1rem;
            text-align: center;
            font-size: 1.1rem;
        }
        
        /* 搜索框 */
        .header-search-container {
            position: relative;
            width: 220px;
            transition: all 0.3s ease;
            flex-shrink: 1;
            min-width: 150px;
        }

        .header-search-input {
            width: 100%;
            padding: 0.7rem 0.85rem 0.7rem 2.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            font-size: 0.9rem;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-weight: 500;
        }

        .header-search-input:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(76, 111, 255, 0.2);
        }

        .header-search-icon {
            position: absolute;
            left: 0.85rem;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.7);
            font-size: 1rem;
        }

        /* 用户信息 */
        .user-menu {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
            cursor: pointer;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1rem;
        }

        .user-name {
            font-size: 0.9rem;
            font-weight: 500;
            display: none;
            color: white;
        }

        @media (min-width: 992px) {
            .user-name {
                display: block;
            }
        }

        /* 用户下拉菜单 */
        .user-dropdown {
            position: absolute;
            top: calc(100% + 10px);
            right: 0;
            background: var(--bg-card);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 12px;
            box-shadow: var(--dropdown-shadow);
            width: 220px;
            padding: 0.75rem 0;
            margin: 0;
            list-style: none;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s ease;
            z-index: 1001;
            border: 1px solid var(--card-border);
        }

        .user-menu:hover .user-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .user-dropdown a {
            display: flex;
            align-items: center;
            gap: 0.85rem;
            padding: 0.85rem 1.5rem;
            color: #1D2129;
            text-decoration: none;
            transition: all 0.2s;
            border-radius: 8px;
            margin: 0 0.25rem;
            font-size: 0.9rem;
        }

        .user-dropdown a:hover {
            background: rgba(76, 111, 255, 0.1);
            color: var(--primary-color);
        }

        /* 主要内容区域布局 */
        .content-wrapper {
            display: flex;
            gap: 1.5rem;
            padding: 1.5rem;
            max-width: 100%;
            box-sizing: border-box;
        }

        /* 左侧边栏 */
        .sidebar {
            width: 320px;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            flex-shrink: 0;
        }

        /* 卡片通用样式 */
        .card {
            background: var(--bg-card);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--card-border);
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
            position: relative;
        }

/* 轻微的悬停动画效果 */
.card:hover {
    transform: translateY(-1px) scale(1.005); /* 极其轻微的上移和缩放 */
    box-shadow: 0 8px 20px -8px rgba(0, 0, 0, 0.15); /* 略微减轻阴影 */
    animation: bounce 0.3s ease; /* 更快的动画速度 */
}

@keyframes bounce {
    0%, 100% { transform: translateY(-1px) scale(1.005); } /* 起始和结束位置 */
    50% { transform: translateY(-2px) scale(1.005); } /* 中间最高位置，仅上移2px */
}

        .card-header {
            padding: 1.25rem 1.75rem;
            border-bottom: 1px solid var(--divider);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: transparent;
        }

        .card-title {
            font-size: 1.15rem;
            font-weight: 600;
            margin: 0;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
        }

        .card-title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary-color);
            transition: width 0.6s ease-out;
        }

        .card:hover .card-title::after {
            width: 100%;
        }

        .card-body {
            padding: 1.25rem 1.75rem;
        }

        /* 账户概览（资产分类） */
        .asset-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.8rem;
            font-size: 0.95rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--divider);
            color: var(--text-primary);
        }

        .asset-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            padding: 0.75rem;
            margin: 0 -0.5rem;
        }

        .asset-item:last-child {
            margin-bottom: 0;
            padding-top: 0.8rem;
            margin-top: 0.5rem;
            border-top: 1px dashed var(--text-tertiary);
            font-weight: 700;
            border-bottom: none;
        }

        /* 大盘指数部分 */
        .major-indices {
            border-radius: 0;
            padding: 0;
            margin-bottom: 0.75rem;
            background: transparent;
            border: none;
        }

        .indices-title {
            font-size: 0.95rem;
            font-weight: 600;
            margin: 1rem 0 0.75rem 0;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .indices-title::before,
        .indices-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--divider), transparent);
        }

        .index-item {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px solid var(--divider);
            transition: all 0.3s;
            color: var(--text-primary);
        }

        .index-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            padding: 0.8rem;
            margin: 0 -0.5rem;
        }

        .index-name {
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .index-change {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            font-weight: 600;
            font-size: 0.95rem;
        }

        /* 涨跌颜色 */
        .change-positive {
            color: var(--danger-color);
        }

        .change-negative {
            color: var(--success-color);
        }

        /* 个股区域标题 */
        .stocks-section-header {
            font-size: 0.95rem;
            font-weight: 600;
            margin: 2rem 0 0.75rem 0;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .stocks-section-header::before,
        .stocks-section-header::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--divider), transparent);
        }

        .movers-container {
            flex-grow: 1;
            min-height: 300px;
        }

        .mover-page {
            display: none;
        }

        .mover-page.active {
            display: block;
        }

        .pagination {
            display: flex;
            justify-content: flex-end;
            margin-top: 1rem;
            gap: 0.5rem;
        }

        .page-btn {
            width: 34px;
            height: 34px;
            border-radius: 8px;
            border: 1px solid var(--card-border);
            background: rgba(255, 255, 255, 0.15);
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .page-btn:hover,
        .page-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        /* 主内容区 */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1.75rem;
        }

        .header {
            margin-bottom: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1.5rem;
        }

        .page-title {
            font-size: 1.85rem;
            font-weight: 700;
            margin: 0;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.85rem;
            letter-spacing: -0.5px;
            position: relative;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .page-title::after {
            content: '';
            width: 8px;
            height: 8px;
            background: var(--secondary-color);
            border-radius: 50%;
            display: inline-block;
            box-shadow: 0 0 10px var(--secondary-color);
        }

        .page-title::before {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            transition: width 0.8s ease-out;
        }

        .header:hover .page-title::before {
            width: 100%;
        }

        /* 实时时钟样式 */
        .live-clock {
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.08);
            padding: 0.5rem 1rem;
            border-radius: 30px;
            min-width: 200px;
            text-align: right;
        }

        .live-clock i {
            color: var(--primary-color);
        }

        .net-worth {
            font-size: 2.25rem;
            font-weight: 800;
            margin: 0.75rem 0 0.35rem;
            color: white; /* 改为白色提高可见度 */
            letter-spacing: -1px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .asset-distribution {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .distribution-item {
            flex: 1;
            min-width: 140px;
            padding: 1.25rem;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            transition: all 0.3s;
            border: 1px solid var(--card-border);
            display: flex;
            flex-direction: column;
        }

        .asset-value {
            font-size: 1.35rem;
            font-weight: 700;
            margin: 0.5rem 0;
            letter-spacing: -0.5px;
            color: var(--text-primary);
        }

        .asset-label {
            color: var(--text-tertiary);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .mover-item {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px solid var(--divider);
            transition: all 0.3s;
            color: var(--text-primary);
        }

        .mover-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            padding: 0.8rem;
            margin: 0 -0.5rem;
        }

        .mover-info {
            display: flex;
            flex-direction: column;
        }

        .mover-name {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .mover-ticker {
            color: var(--text-tertiary);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .mover-price {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .mover-change {
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.2rem;
        }

        /* 主内容区两列布局 */
        .main-cards {
            display: flex;
            gap: 1.75rem;
        }

        .main-card-item {
            flex: 1;
            min-width: 300px;
        }

        /* 悬停显示数字信息 */
        .chart-hover-info {
            position: absolute;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: 8px;
            padding: 10px 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 1px solid var(--card-border);
            font-family: 'Manrope', sans-serif;
            font-size: 0.9rem;
            z-index: 10;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .chart-hover-info-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #1D2129;
        }

        .chart-hover-info-value {
            font-weight: 700;
            color: var(--primary-color);
        }
        
        /* 响应式设计调整 */
        @media (max-width: 1199px) {
            .sidebar {
                width: 300px;
            }
        }

        @media (max-width: 992px) {
            .main-cards {
                flex-direction: column;
            }
        }

        @media (max-width: 768px) {
            .content-wrapper {
                flex-direction: column;
                padding: 1rem;
            }

            .sidebar {
                width: 100%;
            }

            .top-nav {
                padding: 0.5rem 1rem;
            }

            .nav-item span {
                display: none;
            }

            .header-search-container {
                order: 3;
                width: 100%;
                margin-top: 0.5rem;
                margin-bottom: 0.5rem;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
            }
        }

        /* 欢迎横幅 */
        .welcome-banner {
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--accent-color) 100%);
            border-radius: 16px;
            padding: 1.75rem;
            color: white;
            margin-bottom: 1.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 30px rgba(76, 111, 255, 0.2);
            position: relative;
            overflow: hidden;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
        }

        /* 欢迎横幅悬停动画 */
        .welcome-banner:hover {
            transform: translateY(-5px) scale(1.01);
            animation: bounce 0.6s ease;
        }

        .welcome-banner::before {
            content: '';
            position: absolute;
            top: -50px;
            right: -50px;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .welcome-text h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0 0 0.5rem;
            position: relative;
        }

        .welcome-text p {
            font-size: 1rem;
            opacity: 0.9;
            margin: 0;
            max-width: 600px;
            position: relative;
        }

        /* 优化欢迎横幅中的变化率显示 */
        #welcome-change {
            font-weight: 700;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            padding: 0 3px;
            border-radius: 3px;
        }

        .change-positive#welcome-change {
            background-color: rgba(196, 96, 96, 0.2);
        }

        .change-negative#welcome-change {
            background-color: rgba(16, 185, 129, 0.2);
        }
/* 统一风格的下拉选择框 */
.custom-select {
    border-radius: 10px;
    padding: 0.55rem 1rem;
    border: 1px solid var(--card-border);
    background: rgba(255, 255, 255, 0.15); /* 与卡片背景一致 */
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--text-primary); /* 选中状态文字颜色 */
    cursor: pointer;
    transition: all 0.3s;
    appearance: none;
    /* 保持原有箭头图标，但确保颜色适配 */
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ffffff80' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 0.75rem center;
    background-size: 16px;
    padding-right: 2.5rem;
}

/* 下拉选项样式（与整体玻璃态风格统一） */
.custom-select option {
    color: var(--text-primary); /* 选项文字颜色（与界面文字一致） */
    background: var(--top-nav-gray); /* 与顶部导航栏背景一致 */
    border-bottom: 1px solid var(--divider); /* 分隔线与卡片一致 */
    padding: 10px 12px;
    font-weight: 500;
}

/* 选项悬停效果 */
.custom-select option:checked,
.custom-select option:hover {
    background: rgba(76, 111, 255, 0.2); /* 选中/悬停时使用主题色半透明 */
    color: white;
}

        /* 动画效果 */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade {
            animation: fadeIn 0.6s ease-out forwards;
        }

        .delay-100 {
            animation-delay: 0.1s;
        }

        .delay-200 {
            animation-delay: 0.2s;
        }

        .delay-300 {
            animation-delay: 0.3s;
        }

        .delay-400 {
            animation-delay: 0.4s;
        }

        /* 加载状态样式 */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 40px;
            color: var(--primary-color);
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(76, 111, 255, 0.2);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* 错误提示样式 */
        .error-message {
            color: #e53e3e;
            font-size: 0.9rem;
            text-align: center;
            padding: 1rem;
        }

        /* 图表容器尺寸 */
        #net-worth-chart-container {
            height: 350px;
            width: 100%;
        }

        #cash-flow-container {
            height: 300px;
            width: 100%;
        }

        /* 搜索建议框 */
        .search-suggestions {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid var(--card-border);
        }

        .search-suggestions a {
            display: block;
            padding: 8px;
            color: #1D2129 !important;
            text-decoration: none;
        }

        .search-suggestions a:hover {
            background-color: rgba(76, 111, 255, 0.1) !important;
        }

        /* 优化月度变化率的可见度 */
        #monthly-change {
            font-size: 1rem;
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            padding: 3px 8px;
            border-radius: 4px;
            display: inline-block;
        }

        .change-positive#monthly-change {
            background-color: rgba(196, 96, 96, 0.15);
        }

        .change-negative#monthly-change {
            background-color: rgba(16, 185, 129, 0.15);
        }
    </style>
</head>

<body>
    <div class="container-fluid p-0">
        <!-- 顶部导航栏 -->
        <div class="top-nav">
            <div class="logo">
                <i class="fas fa-chart-line fa-lg" style="color: var(--primary-light);"></i>
                <h1>Portfolio <span>Pro</span></h1>
            </div>

            <!-- 导航链接 -->
            <div class="nav-links">
                <a href="index.html" class="nav-item active">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="cash.html" class="nav-item">
                    <i class="fas fa-wallet"></i>
                    <span>Cash</span>
                </a>
                <a href="stocks.html" class="nav-item">
                    <i class="fas fa-chart-line"></i>
                    <span>Stocks</span>
                </a>
                <a href="transactions.html" class="nav-item">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Transactions</span>
                </a>
            </div>

            <!-- 搜索框 -->
            <div class="header-search-container" style="position: relative;">
                <i class="fas fa-search header-search-icon"></i>
                <input type="text" class="header-search-input" placeholder="Search stocks...">
                <ul class="search-suggestions"
                    style="position:absolute; top:100%; left:0; right:0; list-style:none; margin:0; padding:0; z-index:1000;">
                </ul>
            </div>

            <!-- 用户信息 -->
            <div class="user-menu">
                <div class="user-avatar" title="John Doe">JD</div>
                <span class="user-name">John Doe</span>
                <i class="fas fa-chevron-down"></i>

                <!-- 用户下拉菜单 -->
                <ul class="user-dropdown">

                         <a href="#" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a>

                </ul>
            </div>
        </div>

        <!-- 内容区域 -->
        <div class="content-wrapper">
            <!-- 左侧边栏 -->
            <div class="sidebar">
                <!-- 账户概览（资产分类） -->
                <div class="card account-overview animate-fade">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-chart-pie"></i> Asset Breakdown</h3>
                    </div>
                    <div class="card-body">
                        <div class="asset-summary">
                            <div class="asset-item">
                                <span>Cash</span>
                                <span id="sidebar-cash">
                                    <div class="loading">
                                        <div class="spinner"></div>
                                        <span>Loading...</span>
                                    </div>
                                </span>
                            </div>
                            <div class="asset-item">
                                <span>Stocks</span>
                                <span id="sidebar-stock">
                                    <div class="loading">
                                        <div class="spinner"></div>
                                        <span>Loading...</span>
                                    </div>
                                </span>
                            </div>
                            <div class="asset-item">
                                <span>Bonds</span>
                                <span id="sidebar-bond">
                                    <div class="loading">
                                        <div class="spinner"></div>
                                        <span>Loading...</span>
                                    </div>
                                </span>
                            </div>
                            <div class="asset-item">
                                <span>Crypto</span>
                                <span id="sidebar-crypto">
                                    <div class="loading">
                                        <div class="spinner"></div>
                                        <span>Loading...</span>
                                    </div>
                                </span>
                            </div>
                            <div class="asset-item">
                                <span>Total Assets</span>
                                <span id="sidebar-total">
                                    <div class="loading">
                                        <div class="spinner"></div>
                                        <span>Loading...</span>
                                    </div>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 市场动态 -->
                <div class="card market-movers-card animate-fade delay-100">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-chart-bar"></i> Market Movers</h3>
                    </div>
                    <div class="card-body market-movers">
                        <!-- 大盘指数部分 -->
                        <div class="major-indices">
                            <div class="indices-title">
                                <i class="fab fa-napster"></i>
                                <span>Major Indices</span>
                            </div>
                            <div id="indices-container">
                                <!-- 指数数据将通过JavaScript动态加载 -->
                                <div class="index-item">
                                    <span class="index-name"><i class="fas fa-sync-alt fa-spin"></i> Loading indices...</span>
                                    <div class="index-change"></div>
                                </div>
                            </div>
                        </div>

                        <!-- 个股区域标题 -->
                        <div class="stocks-section-header">
                            <i class="fas fa-layer-group"></i>
                            <span>Individual Assets</span>
                        </div>

                        <div class="movers-container">
                            <!-- 第一页 - 股票列表 -->
                            <div class="mover-page active" data-page="1" id="stock-page-1">
                                <div class="loading">
                                    <div class="spinner"></div>
                                    <span>Loading assets...</span>
                                </div>
                            </div>

                            <!-- 第二页 - 股票列表 -->
                            <div class="mover-page" data-page="2" id="stock-page-2">
                                <div class="loading">
                                    <div class="spinner"></div>
                                    <span>Loading assets...</span>
                                </div>
                            </div>
                        </div>

                        <!-- 分页按钮 -->
                        <div class="pagination">
                            <button class="page-btn active" data-page="1">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="page-btn" data-page="2">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 主内容区 -->
            <div class="main-content">
                <!-- 欢迎横幅 -->
                <div class="welcome-banner animate-fade delay-200">
                    <button class="close-banner"
                        style="position: absolute; top: 1rem; right: 1rem; background: transparent; border: none; color: white; font-size: 1.2rem; cursor: pointer; opacity: 0.8; transition: opacity 0.3s;">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="welcome-text">
                        <h2>Welcome back, John!</h2>
                        <p>Your portfolio is up <span id="welcome-change" class="change-positive">-</span> this month.
                            Review your latest investments and market trends.</p>
                    </div>
                    <div style="position: relative;">
                        <i class="fas fa-chart-line fa-3x" style="opacity: 0.9;"></i>
                    </div>
                </div>

                <div class="header">
                    <h2 class="page-title">Financial Dashboard</h2>
                    <!-- 实时时钟 -->
                    <div class="live-clock" id="live-clock">
                        <i class="fas fa-clock"></i>
                        <span id="current-datetime"></span>
                    </div>
                </div>

                <!-- 净值卡片 -->
                <div class="card animate-fade delay-300">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-piggy-bank"></i> Net Worth</h3>
                        <div>
                            <select class="custom-select" id="time-period-select">
                                <option value="3">Three Months</option>
                                <option value="6" selected>Six Months</option>
                                <option value="12">One Year</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="net-worth" id="total-asset">
                            <div class="loading">
                                <div class="spinner"></div>
                                <span>Loading...</span>
                            </div>
                        </div>
                        <div class="change-positive" id="monthly-change">
                            <i class="fas fa-arrow-up"></i> <span>Loading...</span> from last month
                        </div>
                        <!-- 净值图表容器 -->
                        <div class="chart-container mt-4" id="net-worth-chart-container">
                            <canvas id="net-worth-chart"></canvas>
                            <div class="chart-hover-info" id="net-worth-hover"></div>
                        </div>
                    </div>
                </div>

                <!-- 两列布局: 现金流 & 资产配置 -->
                <div class="main-cards">
                    <!-- 现金流 -->
                    <div class="main-card-item">
                        <div class="card h-100 animate-fade delay-300">
                            <div class="card-header">
                                <h3 class="card-title"><i class="fas fa-money-bill-wave"></i> Cash Flow</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-container" id="cash-flow-container">
                                    <canvas id="cash-flow-chart"></canvas>
                                    <div class="chart-hover-info" id="cash-flow-hover"></div>
                                </div>
                                <div class="asset-distribution mt-3">
                                    <div class="distribution-item">
                                        <div class="asset-label">Total Income</div>
                                        <div class="asset-value" id="sum-income">
                                            <div class="loading">
                                                <div class="spinner"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="distribution-item">
                                        <div class="asset-label">Total Expenses</div>
                                        <div class="asset-value" id="sum-expenses">
                                            <div class="loading">
                                                <div class="spinner"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="distribution-item">
                                        <div class="asset-label">Net Flow</div>
                                        <div class="asset-value change-positive" id="net-flow">
                                            <div class="loading">
                                                <div class="spinner"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 资产配置 -->
                    <div class="main-card-item">
                        <div class="card h-100 animate-fade delay-400">
                            <div class="card-header">
                                <h3 class="card-title"><i class="fas fa-chart-pie"></i> Asset Allocation</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-container" id="asset-allocation-container">
                                    <canvas id="asset-allocation-chart"></canvas>
                                    <div class="chart-hover-info" id="asset-allocation-hover"></div>
                                </div>

                                <!-- 资产分布可视化 -->
                                <div class="asset-distribution mt-3">
                                    <div class="distribution-item">
                                        <div class="asset-label">Stocks</div>
                                        <div class="asset-value" id="main-stock-value">
                                            <div class="loading">
                                                <div class="spinner"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="distribution-item">
                                        <div class="asset-label">Bonds</div>
                                        <div class="asset-value" id="main-bond-value">
                                            <div class="loading">
                                                <div class="spinner"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="distribution-item">
                                        <div class="asset-label">Cash</div>
                                        <div class="asset-value" id="main-cash-value">
                                            <div class="loading">
                                                <div class="spinner"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="distribution-item">
                                        <div class="asset-label">Crypto</div>
                                        <div class="asset-value" id="main-crypto-value">
                                            <div class="loading">
                                                <div class="spinner"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>

    <script>
        // 配置API基础URL
        const API_BASE_URL = 'http://localhost:3000';

        let stockList = [];

        window.addEventListener('DOMContentLoaded', async () => {
            // 获取 symbol 列表
            try {
                const res = await fetch('/assetList/getall');
                stockList = await res.json();
            } catch (error) {
                console.error('Error fetching asset list:', error);
            }
        });

        const input = document.querySelector('.header-search-input');
        const suggestions = document.querySelector('.search-suggestions');

        input.addEventListener('input', () => {
            const query = input.value.trim().toLowerCase();
            suggestions.innerHTML = '';

            if (!query) return;

            const matches = stockList.filter(stock =>
                stock.symbol.toLowerCase().includes(query) ||
                stock.name.toLowerCase().includes(query)
            );

            matches.forEach(stock => {
                const li = document.createElement('li');
                li.innerHTML = `<a href="/transactions.html">${stock.symbol} - ${stock.name}</a>`;
                suggestions.appendChild(li);
            });
        });



        // logout 
        document.getElementById('logout-btn').addEventListener('click', async function (e) {
    e.preventDefault(); // 阻止默认跳转行为

    try {
      const res = await fetch('/user/logout', {
        method: 'POST', // 根据你后端写法决定是 GET 还是 POST
        credentials: 'include' 
      });

      if (res.ok) {
        window.location.href = '/login.html'; // 注销成功后跳转到登录页面
      } else {
        alert('Logout failed.');
      }
    } catch (err) {
      console.error('Logout error:', err);
      alert('Network error.');
    }
  });
        // 格式化货币显示
        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2
            }).format(parseFloat(value));
        }

        // 格式化月份显示
        function formatMonth(monthString) {
            const [year, month] = monthString.split('-');
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            return `${monthNames[parseInt(month) - 1]} ${year}`;
        }

        // 通用API请求函数
        async function apiRequest(endpoint, method = 'GET') {
            try {
                const url = API_BASE_URL ? `${API_BASE_URL}${endpoint}` : endpoint;
                const response = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.statusText}`);
                }

                return await response.json();
            } catch (error) {
                console.error(`Error fetching ${endpoint}:`, error);
                throw error;
            }
        }
        
        // 获取大盘指数数据
        async function fetchMarketIndices() {
            try {
                const indices = await apiRequest('/assetList/getIndex');
                const container = document.getElementById('indices-container');
                
                if (!container) return;
                
                // 清空容器
                container.innerHTML = '';
                
                // 定义指数图标映射
                const indexIcons = {
                    'NASDAQ': 'fab fa-napster',
                    'DOWJONES': 'fas fa-industry',
                    'HANGSENG': 'fas fa-chart-line'
                };
                
                // 遍历指数数据并创建元素
                indices.forEach(index => {
                    const indexItem = document.createElement('div');
                    indexItem.className = 'index-item';
                    
                    // 获取对应的图标类
                    const iconClass = indexIcons[index.symbol] || 'fas fa-chart-line';
                    
                    // 计算变化百分比
                    const changePercent = (index.change).toFixed(2);
                    
                    // 确定涨跌颜色类
                    const changeClass = index.change >= 0 ? 'change-positive' : 'change-negative';
                    const arrowIcon = index.change >= 0 ? 'fa-arrow-up' : 'fa-arrow-down';
                    
                    // 设置HTML内容
                    indexItem.innerHTML = `
                        <span class="index-name"><i class="${iconClass}"></i> ${index.symbol}</span>
                        <div class="index-change ${changeClass}">
                            <span class="index-value">${parseFloat(index.price).toFixed(2)}</span>
                            <span><i class="fas ${arrowIcon}"></i>${changePercent}%</span>
                        </div>
                    `;
                    
                    container.appendChild(indexItem);
                });
                
                return indices;
            } catch (error) {
                console.error('Error fetching market indices:', error);
                const container = document.getElementById('indices-container');
                if (container) {
                    container.innerHTML = `
                        <div class="index-item">
                            <span class="error-message">Failed to load indices data</span>
                        </div>
                    `;
                }
            }
        }
        
        // 获取最新资产数据
        async function fetchLatestAsset() {
            try {
                const data = await apiRequest('/asset/latest');

                // 更新净值显示
                document.getElementById('total-asset').textContent = formatCurrency(data.total_asset);

                // 更新左侧边栏资产数据
                document.getElementById('sidebar-cash').textContent = formatCurrency(data.cash);
                document.getElementById('sidebar-stock').textContent = formatCurrency(data.stock_value);
                document.getElementById('sidebar-bond').textContent = formatCurrency(data.bond_value);
                document.getElementById('sidebar-crypto').textContent = formatCurrency(data.crypto_value);
                document.getElementById('sidebar-total').textContent = formatCurrency(data.total_asset);

                // 更新主内容区资产数据
                document.getElementById('main-cash-value').textContent = formatCurrency(data.cash);
                document.getElementById('main-stock-value').textContent = formatCurrency(data.stock_value);
                document.getElementById('main-bond-value').textContent = formatCurrency(data.bond_value);
                document.getElementById('main-crypto-value').textContent = formatCurrency(data.crypto_value);

                // 更新资产配置图表
                updateAssetAllocationChart(data);

                return data;
            } catch (error) {
                console.error('Error fetching latest asset data:', error);
                const errorText = 'Data unavailable';
                document.getElementById('total-asset').textContent = errorText;
                document.getElementById('sidebar-cash').textContent = errorText;
                document.getElementById('sidebar-stock').textContent = errorText;
                document.getElementById('sidebar-bond').textContent = errorText;
                document.getElementById('sidebar-crypto').textContent = errorText;
                document.getElementById('sidebar-total').textContent = errorText;
                document.getElementById('main-cash-value').textContent = errorText;
                document.getElementById('main-stock-value').textContent = errorText;
                document.getElementById('main-bond-value').textContent = errorText;
                document.getElementById('main-crypto-value').textContent = errorText;
            }
        }

        // 获取月度资产数据（用于计算增长率和净值图表）
        async function fetchMonthlyAssets(months = 6) {
            try {
                const data = await apiRequest(`/asset/months/${months}`);

                // 按时间升序排列
                const sortedData = [...data].sort((a, b) => {
                    return new Date(a.month) - new Date(b.month);
                });

                // 更新净值图表
                updateNetWorthChart(sortedData);

                // 计算近2个月增长率
                if (sortedData.length >= 2) {
                    const currentMonth = sortedData[sortedData.length - 1];
                    const prevMonth = sortedData[sortedData.length - 2];
                    const currentValue = parseFloat(currentMonth.total_asset);
                    const prevValue = parseFloat(prevMonth.total_asset);
                    const changePercent = ((currentValue - prevValue) / prevValue * 100).toFixed(1);

                    // 更新月度变化率
                    const changeElement = document.querySelector('#monthly-change');
                    const welcomeChangeElement = document.getElementById('welcome-change');

                    if (parseFloat(changePercent) >= 0) {
                        changeElement.className = 'change-positive';
                        changeElement.innerHTML = `<i class="fas fa-arrow-up"></i> <span>${changePercent}%</span> from last month`;
                        welcomeChangeElement.className = 'change-positive';
                    } else {
                        changeElement.className = 'change-negative';
                        changeElement.innerHTML = `<i class="fas fa-arrow-down"></i> <span>${Math.abs(changePercent)}%</span> from last month`;
                        welcomeChangeElement.className = 'change-negative';
                    }

                    welcomeChangeElement.textContent = `${changePercent}%`;
                }

                return sortedData;
            } catch (error) {
                console.error('Error fetching monthly asset data:', error);
                document.querySelector('#monthly-change span').textContent = 'Data unavailable';
                document.getElementById('welcome-change').textContent = 'Data unavailable';
            }
        }
        
        // 获取现金流数据 - 固定为6个月
        async function fetchCashFlow() {
            const months = 6; // 固定为6个月
            try {
                const incomeData = await apiRequest(`/cash/income/${months}`);
                const outcomeData = await apiRequest(`/cash/outcome/${months}`);

                // 处理支出数据可能的结构差异
                const normalizedOutcome = outcomeData.map(item => ({
                    month: item.month,
                    outcome: item.outcome || item.value || 0
                }));

                // 过滤掉Jan 2025的数据
                const filteredIncome = incomeData.filter(item => item.month !== '2025-01');
                const filteredOutcome = normalizedOutcome.filter(item => item.month !== '2025-01');

                // 按时间升序排列
                const sortedIncome = [...filteredIncome].sort((a, b) => {
                    return new Date(a.month) - new Date(b.month);
                });

                const sortedOutcome = [...filteredOutcome].sort((a, b) => {
                    return new Date(a.month) - new Date(b.month);
                });

                // 确保只显示最近6个月的数据
                const recentIncome = sortedIncome.slice(-6);
                const recentOutcome = sortedOutcome.slice(-6);

                // 更新现金流图表
                updateCashFlowChart(recentIncome, recentOutcome);

                // 计算总和
                const totalIncome = recentIncome.reduce((sum, item) => sum + parseFloat(item.income || 0), 0);
                const totalExpenses = recentOutcome.reduce((sum, item) => sum + parseFloat(item.outcome || 0), 0);
                const netFlow = totalIncome - totalExpenses;

                // 更新现金流摘要
                document.getElementById('sum-income').textContent = formatCurrency(totalIncome);
                document.getElementById('sum-expenses').textContent = formatCurrency(totalExpenses);

                const netFlowElement = document.getElementById('net-flow');
                netFlowElement.textContent = formatCurrency(netFlow);

                // 设置净值颜色
                if (netFlow >= 0) {
                    netFlowElement.className = 'asset-value change-positive';
                } else {
                    netFlowElement.className = 'asset-value change-negative';
                }

                return { incomeData: recentIncome, outcomeData: recentOutcome };
            } catch (error) {
                console.error('Error fetching cash flow data:', error);
                const errorText = 'Data unavailable';
                document.getElementById('sum-income').textContent = errorText;
                document.getElementById('sum-expenses').textContent = errorText;
                document.getElementById('net-flow').textContent = errorText;
            }
        }

        // 获取资产列表和价格
        async function fetchAssetList() {
            try {
                const assets = await apiRequest('/assetList/getall');

                // 分两页显示
                const page1 = assets.slice(0, 6);
                const page2 = assets.slice(6);

                // 渲染第一页
                renderAssetPage(page1, 'stock-page-1');

                // 渲染第二页
                renderAssetPage(page2, 'stock-page-2');

                return assets;
            } catch (error) {
                console.error('Error fetching asset list:', error);
                document.getElementById('stock-page-1').innerHTML = '<div class="error-message">Failed to load assets</div>';
                document.getElementById('stock-page-2').innerHTML = '<div class="error-message">Failed to load assets</div>';
            }
        }

        // 获取资产价格和变化
        async function fetchAssetPrice(symbol) {
            try {
                return await apiRequest(`/assetList/getpriceAndCh?symbol=${symbol}`);
            } catch (error) {
                console.error(`Error fetching price for ${symbol}:`, error);
                return null;
            }
        }

        // 渲染资产页面
        async function renderAssetPage(assets, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = '';

            for (const asset of assets) {
                try {
                    // 获取资产价格和变化
                    const priceData = await fetchAssetPrice(asset.symbol);

                    if (!priceData) {
                        throw new Error('Price data unavailable');
                    }

                    // 创建资产项
                    const assetItem = document.createElement('div');
                    assetItem.className = 'mover-item';

                    const change = parseFloat(priceData.change);
                    const changeClass = change >= 0 ? 'change-positive' : 'change-negative';
                    const arrowIcon = change >= 0 ? 'fa-arrow-up' : 'fa-arrow-down';
                    const changeText = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;

                    assetItem.innerHTML = `
                        <div class="mover-info">
                            <span class="mover-name">${asset.name}</span>
                            <span class="mover-ticker">${asset.symbol}</span>
                        </div>
                        <div class="mover-change">
                            <span class="mover-price">${formatCurrency(priceData.price)}</span>
                            <span class="${changeClass}"><i class="fas ${arrowIcon}"></i> ${changeText}</span>
                        </div>
                    `;

                    container.appendChild(assetItem);
                } catch (error) {
                    console.error(`Error loading data for ${asset.symbol}:`, error);
                    const errorItem = document.createElement('div');
                    errorItem.className = 'mover-item';
                    errorItem.innerHTML = `
                        <div class="mover-info">
                            <span class="mover-name">${asset.name}</span>
                            <span class="mover-ticker">${asset.symbol}</span>
                        </div>
                        <div class="mover-change">Data unavailable</div>
                    `;
                    container.appendChild(errorItem);
                }
            }
        }

        // 更新净值图表
        function updateNetWorthChart(data) {
            if (!data || data.length === 0) {
                console.error('No data available for net worth chart');
                return;
            }

            const ctx = document.getElementById('net-worth-chart').getContext('2d');

            // 准备数据
            const labels = data.map(item => formatMonth(item.month));
            const values = data.map(item => parseFloat(item.total_asset));

            // 创建渐变
            const gradient = ctx.createLinearGradient(0, 0, 0, 260);
            gradient.addColorStop(0, 'rgba(76, 111, 255, 0.2)');
            gradient.addColorStop(1, 'rgba(76, 111, 255, 0.05)');

            // 销毁现有图表
            if (window.netWorthChart) {
                window.netWorthChart.destroy();
            }

            // 创建新图表
            window.netWorthChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Net Worth',
                        data: values,
                        borderColor: '#4C6FFF',
                        backgroundColor: gradient,
                        borderWidth: 3,
                        pointRadius: 5,
                        pointBackgroundColor: '#FFFFFF',
                        pointBorderWidth: 2,
                        pointBorderColor: '#4C6FFF',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                callback: value => `$${(value / 1000).toFixed(1)}k`,
                                font: { size: 12, family: 'Manrope' },
                                color: 'white' // 改为白色
                            }
                        },
                        x: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                font: { family: 'Manrope' },
                                color: 'white' // 改为白色
                            }
                        }
                    }
                }
            });

            // 添加悬停交互
            const netWorthContainer = document.getElementById('net-worth-chart-container');
            const netWorthHover = document.getElementById('net-worth-hover');

            // 移除旧事件监听器
            netWorthContainer.removeEventListener('mousemove', handleNetWorthMouseMove);
            netWorthContainer.removeEventListener('mouseleave', handleNetWorthMouseLeave);

            function handleNetWorthMouseMove(e) {
                const rect = ctx.canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                // 查找最近的数据点
                const points = window.netWorthChart.getElementsAtEventForMode(e, 'nearest', { intersect: true }, true);
                if (points.length) {
                    const point = points[0];
                    const index = point.index;
                    const value = window.netWorthChart.data.datasets[0].data[index];
                    const label = window.netWorthChart.data.labels[index];

                    // 更新悬停信息
                    netWorthHover.innerHTML = `
                        <div class="chart-hover-info-title">${label} Net Worth</div>
                        <div class="chart-hover-info-value">$${value.toLocaleString()}</div>
                    `;
                    
                    // 计算信息框位置
                    const containerRect = netWorthContainer.getBoundingClientRect();
                    const hoverWidth = 150;
                    const hoverHeight = 60;
                    
                    let hoverX = x + 10;
                    let hoverY = y + 10;

                    // 边界检查
                    if (hoverX + hoverWidth > containerRect.width) {
                        hoverX = x - hoverWidth - 10;
                    }
                    if (hoverY + hoverHeight > containerRect.height) {
                        hoverY = y - hoverHeight - 10;
                    }

                    netWorthHover.style.left = `${hoverX}px`;
                    netWorthHover.style.top = `${hoverY}px`;
                    netWorthHover.style.opacity = '1';
                } else {
                    netWorthHover.style.opacity = '0';
                }
            }

            function handleNetWorthMouseLeave() {
                netWorthHover.style.opacity = '0';
            }

            netWorthContainer.addEventListener('mousemove', handleNetWorthMouseMove);
            netWorthContainer.addEventListener('mouseleave', handleNetWorthMouseLeave);
        }

        // 更新现金流图表
        function updateCashFlowChart(incomeData, outcomeData) {
            if (!incomeData || !outcomeData || incomeData.length === 0 && outcomeData.length === 0) {
                console.error('No data available for cash flow chart');
                return;
            }

            const ctx = document.getElementById('cash-flow-chart').getContext('2d');

            // 确保数据按月份排序并对齐
            const months = [...new Set([...incomeData.map(i => i.month), ...outcomeData.map(o => o.month)])].sort();

            // 准备收入和支出数据
            const incomeValues = months.map(month => {
                const item = incomeData.find(i => i.month === month);
                return item ? parseFloat(item.income || 0) : 0;
            });

            const outcomeValues = months.map(month => {
                const item = outcomeData.find(o => o.month === month);
                return item ? parseFloat(item.outcome || 0) : 0;
            });

            // 格式化标签
            const labels = months.map(month => formatMonth(month));

            // 销毁现有图表
            if (window.cashFlowChart) {
                window.cashFlowChart.destroy();
            }

            // 计算最大值，为Y轴设置合理的范围
            const maxIncome = Math.max(...incomeValues);
            const maxOutcome = Math.max(...outcomeValues);
            const maxValue = Math.max(maxIncome, maxOutcome);
            const yAxisMax = maxValue > 0 ? maxValue * 1.1 : 1000;

            // 创建新图表
            window.cashFlowChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Income',
                            data: incomeValues,
                            backgroundColor: '#9576d2',
                            borderRadius: 6,
                            borderSkipped: false,
                            barThickness: 20
                        },
                        {
                            label: 'Expenses',
                            data: outcomeValues,
                            backgroundColor: '#74ebc4',
                            borderRadius: 6,
                            borderSkipped: false,
                            barThickness: 20
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 13, family: 'Manrope' },
                                color: 'white', // 改为白色
                                usePointStyle: true,
                                padding: 20
                            }
                        },
                        tooltip: { enabled: false }
                    },
                    scales: {
                        y: {
                            min: 0,
                            max: yAxisMax,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                callback: value => `$${value >= 1000 ? (value / 1000).toFixed(1) + 'k' : value}`,
                                font: { size: 12, family: 'Manrope' },
                                color: 'white' // 改为白色
                            }
                        },
                        x: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                font: { family: 'Manrope' },
                                color: 'white' // 改为白色
                            }
                        }
                    }
                }
            });

            // 添加悬停效果
            const cashFlowContainer = document.getElementById('cash-flow-container');
            const cashFlowHover = document.getElementById('cash-flow-hover');
            
            // 移除旧事件监听器
            cashFlowContainer.removeEventListener('mousemove', cashFlowMouseMoveHandler);
            cashFlowContainer.removeEventListener('mouseleave', cashFlowMouseLeaveHandler);

            function cashFlowMouseMoveHandler(e) {
                const canvas = ctx.canvas;
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                // 查找最近的柱状图
                const points = window.cashFlowChart.getElementsAtEventForMode(e, 'nearest', { intersect: true }, true);
                if (points.length) {
                    const bar = points[0];
                    const datasetIndex = bar.datasetIndex;
                    const index = bar.index;

                    const dataset = window.cashFlowChart.data.datasets[datasetIndex];
                    const value = dataset.data[index];
                    const label = window.cashFlowChart.data.labels[index];

                    // 更新悬停信息
                    cashFlowHover.innerHTML = `
                        <div class="chart-hover-info-title">${label} - ${datasetIndex === 0 ? 'Income' : 'Expenses'}</div>
                        <div class="chart-hover-info-value">$${value.toLocaleString()}</div>
                    `;

                    cashFlowHover.style.left = `${x + 15}px`;
                    cashFlowHover.style.top = `${y + 15}px`;
                    cashFlowHover.style.opacity = '1';
                } else {
                    cashFlowHover.style.opacity = '0';
                }
            }

            function cashFlowMouseLeaveHandler() {
                cashFlowHover.style.opacity = '0';
            }

            cashFlowContainer.addEventListener('mousemove', cashFlowMouseMoveHandler);
            cashFlowContainer.addEventListener('mouseleave', cashFlowMouseLeaveHandler);
        }

        // 更新资产配置图表
        function updateAssetAllocationChart(data) {
            if (!data) {
                console.error('No data available for asset allocation chart');
                return;
            }

            const ctx = document.getElementById('asset-allocation-chart').getContext('2d');

            // 准备数据
            const labels = ['Stocks', 'Bonds', 'Cash', 'Crypto'];
            const values = [
                parseFloat(data.stock_value) || 0,
                parseFloat(data.bond_value) || 0,
                parseFloat(data.cash) || 0,
                parseFloat(data.crypto_value) || 0
            ];
            const colors = ['#4C6FFF', '#1BC5BD', '#8950FC', '#F59E0B'];

            // 销毁现有图表
            if (window.assetChart) {
                window.assetChart.destroy();
            }

            // 创建新图表
            window.assetChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: colors,
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: { size: 13, family: 'Manrope' },
                                color: 'white', // 改为白色
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: { enabled: false }
                    },
                    cutout: '65%'
                }
            });

            // 添加悬停效果
            const assetAllocationContainer = document.getElementById('asset-allocation-container');
            const assetAllocationHover = document.getElementById('asset-allocation-hover');
            
            // 移除旧事件监听器
            assetAllocationContainer.removeEventListener('mousemove', assetAllocationMouseMoveHandler);
            assetAllocationContainer.removeEventListener('mouseleave', assetAllocationMouseLeaveHandler);

            function assetAllocationMouseMoveHandler(e) {
                const canvas = ctx.canvas;
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                const points = window.assetChart.getElementsAtEventForMode(e, 'nearest', { intersect: true }, true);
                if (points.length) {
                    const slice = points[0];
                    const index = slice.index;

                    const label = window.assetChart.data.labels[index];
                    const value = window.assetChart.data.datasets[0].data[index];
                    const total = window.assetChart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                    const percentage = total > 0 ? Math.round((value / total) * 100) : 0;
                    
                    // 更新悬停信息
                    assetAllocationHover.innerHTML = `
                        <div class="chart-hover-info-title">${label}</div>
                        <div class="chart-hover-info-value">${formatCurrency(value)} (${percentage}%)</div></div>
                    `;

                    assetAllocationHover.style.left = `${x + 15}px`;
                    assetAllocationHover.style.top = `${y + 15}px`;
                    assetAllocationHover.style.opacity = '1';
                } else {
                    assetAllocationHover.style.opacity = '0';
                }
            }

            function assetAllocationMouseLeaveHandler() {
                assetAllocationHover.style.opacity = '0';
            }

            assetAllocationContainer.addEventListener('mousemove', assetAllocationMouseMoveHandler);
            assetAllocationContainer.addEventListener('mouseleave', assetAllocationMouseLeaveHandler);
        }

        // 更新实时时钟
        function updateDateTime() {
            const now = new Date();
            const options = {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            };

            document.getElementById('current-datetime').textContent = now.toLocaleDateString('en-US', options);
        }

        // 初始化页面
        document.addEventListener('DOMContentLoaded', function () {
            // 启动时钟
            updateDateTime();
            setInterval(updateDateTime, 1000);

            // 加载数据
            fetchLatestAsset();
            fetchMonthlyAssets();
            fetchCashFlow();
            fetchAssetList();
            fetchMarketIndices();
            
            // 时间范围选择器
            document.getElementById('time-period-select').addEventListener('change', function(e) {
                const months = parseInt(e.target.value);
                fetchMonthlyAssets(months);
            });
            
            // 分页按钮
            const paginationContainer = document.querySelector('.pagination');
            if (paginationContainer) {
                paginationContainer.addEventListener('click', function(e) {
                    const btn = e.target.closest('.page-btn');
                    if (btn) {
                        const page = btn.getAttribute('data-page');

                        // 更新按钮状态
                        document.querySelectorAll('.page-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');

                        // 更新显示页面
                        document.querySelectorAll('.mover-page').forEach(p => p.classList.remove('active'));
                        document.querySelector(`.mover-page[data-page="${page}"]`).classList.add('active');
                    }
                });
            }

            // 关闭欢迎横幅
            document.querySelector('.close-banner').addEventListener('click', function () {
                document.querySelector('.welcome-banner').style.opacity = '0';
                setTimeout(() => {
                    document.querySelector('.welcome-banner').style.display = 'none';
                }, 300);
            });
        });
    </script>
</body>

</html>